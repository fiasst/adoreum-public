Object.defineProperty(String.prototype,"capFirst",{value:function(){return this.charAt(0).toUpperCase()+this.slice(1)},enumerable:!1});var REPORTS=function($,e,t,a){let s={};return s.charts=[],s.members=[],s.current=0,s.total=0,s.genders={},s.countries={},s.primarycity={},s.motives={},s.ageRanges={},s.investors={},s.joined={},s.referrer={},s.plans={},s.subscriberStatus=[],s.getMemberData=e=>{USER.getCurrentMember((function(t){if(HELP.checkKeyExists(t,"id")){let a=e?"&after="+e:"";MAIN.thinking(!0),HELP.sendAJAX({url:"https://hook.eu2.make.com/72hi83eco73yt3iipj5ua0dctpb5sl35?hasNextPage=true&id="+t.id+a,method:"GET",callbackSuccess:function(e){s.processData(e)},callbackError:function(e){MAIN.thinking(!1),console.log("error")}},!1)}}))},s.processData=(e,t)=>{if(s.members=s.members.concat(e.data),s.current=s.members.length,s.total=e.data[0].totalCount,s.updateSummary(s.current,s.total),"true"!==e.data[0].hasNextPage||t){MAIN.thinking(!1),s.setCache({data:s.members});const e=(e,t)=>{e[t]?e[t]++:e[t]=1};!function(e){MAIN.thinking(!0);var t=$("#members-table").on("draw.dt",(function(){MAIN.thinking(!1)})).DataTable({lengthMenu:[[50,100,-1],[50,100,"All"]],pageLength:50,order:[[12,"asc"],[13,"asc"]],search:{return:!0},layout:{topStart:function(){var e=$("div#column-list");return $("#members-table thead th").each((function(a){var s=$(this).text(),n=$('<li><label><input type="checkbox" checked>'+s+"</label></li>");$("ul",e).append(n),$("input",n).on("change",(function(){t.column(a).visible($(this).is(":checked"))}))})),e}}});e.forEach((function(e){var a=e.customFields.motive?e.customFields.motive.split("|").join(", "):"";let s=[`<a href="https://app.memberstack.com/apps/app_cllao1xky00gp0t4gd37g6u4b/members/${e.id}/profile" target="_blank">${e.customFields.name}</a>`,e.customFields.company||"",e.customFields.gender||"",e.customFields.country||"",e.customFields.primarycity||"",e.customFields["date-of-birth"]||"",a,e.customFields.investor||"",e.customFields.canaccessapp||"",HELP.formatTimestamp(e.createdAt)];0===e.planConnections.length?t.row.add(s.concat(["","","","",""])).draw():e.planConnections.forEach((function(e){if("SUBSCRIPTION"==e.type){var a="";if(e.payment&&e.payment.amount){var n=HELP.formatThousands(e.payment.amount);a="gbp"==e.payment.currency?"Â£"+n:n+" "+e.payment.currency}var r="";if(e.payment&&e.payment.nextBillingDate){var o=HELP.ISOToTimestamp(e.payment.nextBillingDate);r=HELP.formatTimestamp(o,!1,!0)}let i=[e.planName||"N/A",e.status||"N/A",a,e.payment&&e.payment.status||"N/A",r];t.row.add(s.concat(i)).draw()}}))}))}(s.members),$.each(s.members,((t,a)=>{if(a.customFields.gender&&e(s.genders,a.customFields.gender),a.customFields.country?e(s.countries,a.customFields.country):e(s.countries,"Unknown"),a.customFields.primarycity?e(s.primarycity,a.customFields.primarycity):e(s.primarycity,"Unknown"),a.customFields.motive?$.each(a.customFields.motive.split("|"),((t,a)=>{e(s.motives,a)})):e(s.motives,"Unknown"),a.customFields["date-of-birth"]){let t=a.customFields["date-of-birth"].split("/")[2],n=(new Date).getFullYear(),r="Unknown";if(t){const e=n-parseInt(t.trim());e>=16&&e<=25?r="16-25":e>=26&&e<=35?r="26-35":e>=36&&e<=45?r="36-45":e>=46&&e<=55?r="46-55":e>=56&&e<=65?r="56-65":e>=66&&e<=75?r="66-75":e>=76&&e<=85?r="76-85":e>=86&&e<=95?r="86-95":e>=96&&e<=105&&(r="96-105")}e(s.ageRanges,r)}if(a.customFields.investor&&e(s.investors,a.customFields.investor.capFirst()),a.createdAt){let t=new Date(a.createdAt),n=t.getFullYear(),r=t.getMonth()+1;r<10&&(r="0"+r),e(s.joined,`${n}-${r}`)}if(a.customFields.referrer?e(s.referrer,a.customFields.referrer):e(s.referrer,"Unknown"),a.planConnections){let t,n=[];$.each(a.planConnections,((t,a)=>{if("SUBSCRIPTION"==a.type)switch(a.status){case"ACTIVE":n.push("active"),e(s.plans,a.planName);break;case"CANCELED":n.push("canceled");break;case"TRIALING":n.push("trialing");break;case"PAST_DUE":n.push("past_due");break;case"UNPAID":n.push("unpaid")}})),n.includes("active")?t="Active":n.includes("past_due")?t="Past due":n.includes("unpaid")?t="Unpaid":n.includes("canceled")?t="Canceled":n.includes("trialing")?t="Trialing":n.length<1&&(t="Never subscribed"),e(s.subscriberStatus,t)}})),REPORTS.countries=HELP.sortObjectByKeys(REPORTS.countries),REPORTS.motives=HELP.sortObjectByKeys(REPORTS.motives),REPORTS.ageRanges=HELP.sortObjectByKeys(REPORTS.ageRanges),REPORTS.genders=HELP.sortObjectByKeys(REPORTS.genders),s.generateCharts()}else s.getMemberData(e.data[0].endCursor)},s.checkCache=()=>{var e=localStorage.getItem("cachedData");e?(e=JSON.parse(e),((new Date).getTime()-e.timestamp)/36e5<1?(console.log("Use cache"),s.processData(e,!0)):(console.log("Cache expired"),localStorage.removeItem("cachedData"),s.getMemberData())):(console.log("No cache found"),s.getMemberData())},s.setCache=e=>{var t={data:e.data,timestamp:(new Date).getTime()};localStorage.setItem("cachedData",JSON.stringify(t))},s.updateSummary=(e,t)=>{let a=$("#summary");$(".current",a).text(e),$(".total",a).text(t)},s.createChart=(e,a)=>{const n=t.getElementById(e).getContext("2d");s.charts[e.toLowerCase()]=new Chart(n,a)},s.generateCharts=()=>{s.createChart("genderChart",{type:"doughnut",data:{labels:Object.keys(REPORTS.genders),datasets:[{data:Object.values(REPORTS.genders)}]},options:{responsive:!0,plugins:{legend:{position:"top"},tooltip:{enabled:!0}}}}),s.createChart("countriesChart",{type:"doughnut",data:{labels:Object.keys(REPORTS.countries),datasets:[{data:Object.values(REPORTS.countries)}]},options:{responsive:!0,plugins:{legend:{position:"top"},tooltip:{enabled:!0}}}}),s.createChart("primaryCityChart",{type:"doughnut",data:{labels:Object.keys(REPORTS.primarycity),datasets:[{data:Object.values(REPORTS.primarycity)}]},options:{responsive:!0,plugins:{legend:{position:"top"},tooltip:{enabled:!0}}}}),s.createChart("motivesChart",{type:"doughnut",data:{labels:Object.keys(REPORTS.motives),datasets:[{data:Object.values(REPORTS.motives)}]},options:{responsive:!0,plugins:{legend:{position:"top"},tooltip:{enabled:!0}}}}),s.createChart("agesChart",{type:"doughnut",data:{labels:Object.keys(REPORTS.ageRanges),datasets:[{data:Object.values(REPORTS.ageRanges)}]},options:{responsive:!0,plugins:{legend:{position:"top"},tooltip:{enabled:!0}}}}),s.createChart("investorsChart",{type:"doughnut",data:{labels:Object.keys(REPORTS.investors),datasets:[{data:Object.values(REPORTS.investors),backgroundColor:["#D24A4B","#7DC9CC"]}]},options:{responsive:!0,plugins:{legend:{position:"top"},tooltip:{enabled:!0}}}}),s.createChart("plansChart",{type:"doughnut",data:{labels:Object.keys(REPORTS.plans),datasets:[{data:Object.values(REPORTS.plans)}]},options:{responsive:!0,plugins:{legend:{position:"top"},tooltip:{enabled:!0}}}}),s.createChart("subStatusChart",{type:"doughnut",data:{labels:Object.keys(REPORTS.subscriberStatus),datasets:[{data:Object.values(REPORTS.subscriberStatus)}]},options:{responsive:!0,plugins:{legend:{position:"top"},tooltip:{enabled:!0}}}}),s.createChart("joinedChart",{type:"line",data:{labels:Object.keys(REPORTS.joined),datasets:[{data:Object.values(REPORTS.joined),fill:!1,tension:.1}]},options:{responsive:!0,scales:{x:{beginAtZero:!0},y:{beginAtZero:!0}},plugins:{legend:{display:!1},tooltip:{enabled:!0}}}}),s.createChart("referrerChart",{type:"doughnut",data:{labels:Object.keys(REPORTS.referrer),datasets:[{data:Object.values(REPORTS.referrer)}]},options:{responsive:!0,plugins:{legend:{position:"top"},tooltip:{enabled:!0}}}})},$((function(){s.checkCache()})),s}(jQuery,0,this.document);